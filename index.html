<!DOCTYPE html>
<html lang="fr">
    <head>
        <title>SPIT Launcher</title>
        <link rel="stylesheet" href="style.css">
    </head>
    <body>
        <h2>SPIT Launcher</h2>
        <div id="tiles"></div>
        <footer style="text-align:center;margin-top:40px;color:#aaa;font-size:0.95em;">
            <span>VER <span id="ver"></span></span>
        </footer>
        <script>
            const container = document.getElementById('tiles');
                function getJsonPath() {
                    return localStorage.getItem('jsonPath') || './list-apps.json';
                }
                function setJsonPath(path) {
                    localStorage.setItem('jsonPath', path);
                    location.reload();
                }
                function showPathConfig() {
                    const configDiv = document.createElement('div');
                    configDiv.style = 'text-align:center;margin:40px auto;max-width:400px;padding:24px;background:#222;border-radius:10px;box-shadow:0 2px 12px #0003;';
                    configDiv.innerHTML = `
                        <h3>Configurer le chemin du fichier JSON</h3>
                        <input id='jsonPathInput' type='text' value="${getJsonPath()}" style='width:70%;padding:8px;border-radius:5px;border:1px solid #888;font-size:1rem;'>
                        <button id='browseBtn' style='padding:7px 12px;margin-left:8px;border-radius:5px;background:#1976d2;color:#fff;border:none;font-size:1rem;cursor:pointer;'>Parcourir</button>
                        <br><br>
                        <button onclick="localStorage.setItem('jsonPath', document.getElementById('jsonPathInput').value); location.reload();" style='padding:7px 18px;border-radius:5px;background:#1976d2;color:#fff;border:none;font-size:1rem;cursor:pointer;'>Valider</button>
                    `;
                    document.body.innerHTML = '';
                    document.body.appendChild(configDiv);
                    document.getElementById('browseBtn').onclick = async () => {
                        const file = await window.api.openFileDialog();
                        if (file) {
                            document.getElementById('jsonPathInput').value = file;
                        }
                    };
                }
                document.addEventListener('keydown', e => {
                    if (e.ctrlKey && e.key.toLowerCase() === 'j') {
                        showPathConfig();
                    }
                });
                if (!localStorage.getItem('jsonPath')) {
                    showPathConfig();
                } else {
                    fetch(getJsonPath())
                        .then(response => response.json())
                        .then(data => {
                            Object.values(data).forEach(async app => {
                                const tile = document.createElement('div');
                                tile.className = 'tile';
                                tile.style.backgroundColor = app.color;
                                let vscodeBtns = '';
                                let githubBtns = '';
                                // SVG logos
                                const vscodeLogo = `<svg xmlns='http://www.w3.org/2000/svg' width='16' height='16' viewBox='0 0 32 32' style='vertical-align:middle'><path fill='#fff' d='M30.23 6.18L24.09 3.1a2.13 2.13 0 0 0-2.09 0L7.91 11.36l-3.2-2.5a1.07 1.07 0 0 0-1.36.06l-2.1 2a1.07 1.07 0 0 0 0 1.56l3.13 2.7l-3.13 2.7a1.07 1.07 0 0 0 0 1.56l2.1 2a1.07 1.07 0 0 0 1.36.06l3.2-2.5l14.09 8.26a2.13 2.13 0 0 0 2.09 0l6.14-3.08A2.13 2.13 0 0 0 32 22.08V8.92a2.13 2.13 0 0 0-1.77-2.74zM24 25.13L8.36 16L24 6.87z'/></svg>`;
                                const githubLogo = `<svg xmlns='http://www.w3.org/2000/svg' width='16' height='16' viewBox='0 0 24 24' style='vertical-align:middle'><path fill='#fff' d='M12 2C6.477 2 2 6.484 2 12.021c0 4.428 2.865 8.184 6.839 9.504c.5.092.682-.217.682-.482c0-.237-.009-.868-.014-1.703c-2.782.605-3.369-1.342-3.369-1.342c-.454-1.158-1.11-1.466-1.11-1.466c-.908-.62.069-.608.069-.608c1.004.07 1.532 1.032 1.532 1.032c.892 1.53 2.341 1.088 2.91.832c.092-.647.35-1.088.636-1.339c-2.221-.253-4.555-1.113-4.555-4.951c0-1.093.39-1.988 1.029-2.688c-.103-.253-.446-1.272.098-2.65c0 0 .84-.27 2.75 1.025A9.564 9.564 0 0 1 12 6.844c.85.004 1.705.115 2.504.337c1.909-1.295 2.748-1.025 2.748-1.025c.546 1.378.202 2.397.1 2.65c.64.7 1.028 1.595 1.028 2.688c0 3.848-2.337 4.695-4.566 4.944c.359.309.678.919.678 1.852c0 1.336-.012 2.415-.012 2.744c0 .267.18.578.688.48A10.025 10.025 0 0 0 22 12.021C22 6.484 17.523 2 12 2'/></svg>`;
                                const exists = await window.api.checkDirs(app.appId);
                                if (exists.frontend && exists.backend) {
                                    vscodeBtns += `<button class='vsc-btn' onclick=\"window.api.openVSCode('${app.appId}-frontend')\">${vscodeLogo} Frontend</button>`;
                                    vscodeBtns += `<button class='vsc-btn' onclick=\"window.api.openVSCode('${app.appId}-backend')\">${vscodeLogo} Backend</button>`;
                                    githubBtns += `<button class='gh-btn' onclick=\"window.api.openGitHubRepo('spit-${app.appId}-frontend')\">${githubLogo} GitHub Frontend</button>`;
                                    githubBtns += `<button class='gh-btn' onclick=\"window.api.openGitHubRepo('spit-${app.appId}-backend')\">${githubLogo} GitHub Backend</button>`;
                                } else if (exists.frontend) {
                                    vscodeBtns += `<button class='vsc-btn' onclick=\"window.api.openVSCode('${app.appId}-frontend')\">${vscodeLogo} Frontend</button>`;
                                    githubBtns += `<button class='gh-btn' onclick=\"window.api.openGitHubRepo('spit-${app.appId}-frontend')\">${githubLogo} GitHub Frontend</button>`;
                                } else if (exists.backend) {
                                    vscodeBtns += `<button class='vsc-btn' onclick=\"window.api.openVSCode('${app.appId}-backend')\">${vscodeLogo} Backend</button>`;
                                    githubBtns += `<button class='gh-btn' onclick=\"window.api.openGitHubRepo('spit-${app.appId}-backend')\">${githubLogo} GitHub Backend</button>`;
                                } else {
                                    vscodeBtns += `<button class='vsc-btn' onclick=\"window.api.openVSCode('${app.appId}')\">${vscodeLogo} Ouvrir VSCode</button>`;
                                    githubBtns += `<button class='gh-btn' onclick=\"window.api.openGitHubRepo('spit-${app.appId}')\">${githubLogo} GitHub</button>`;
                                }
                                tile.innerHTML = `
                                    <h3>${app.application}</h3>
                                    <span class='badge'>${app.clientId}</span>
                                    <div class='btn-group'>${vscodeBtns}</div>
                                    <div class='btn-group'>${githubBtns}</div>
                                `;
                                container.appendChild(tile);
                            });
                        });
                }
        </script>
        <script>
            (async () => {
                if (window.api.getVersion) {
                    document.getElementById('ver').textContent = await window.api.getVersion();
                }
            })();
        </script>
    </body>
</html>